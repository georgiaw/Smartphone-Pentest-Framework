#!/usr/bin/env bash
#
# This is a Kali Linux installer for the Smartphone Pentest Framework
#######################################################################

# Check to ensure the script is run as root/sudo
if [ "$(id -u)" != "0" ]; then
   echo "This script must be run as root or with sudo. Exiting." 1>&2
   exit 1
fi

echo -e "Installing required packages...\n"

apt-get install ant

wget http://dl.google.com/android/android-sdk_r21-linux.tgz
tar -xvzf android-sdk_r21-linux.tgz

export PATH=${PATH}:${PWD}/android-sdk-linux/tools:${PWD}/android-sdk-linux/platform-tools

android update sdk --no-ui -a --filter platform-tool,android-4,addon-google_apis-google-4,android-14,addon-google_apis-google-14

echo -e "Configuring php...\n"

sed -i "s/post_max_size .*/post_max_size=100M/" /etc/php5/apache2/php.ini
sed -i "s/upload_max_filesize .*/upload_max_filesize =100M/" /etc/php5/apache2/php.ini

echo -e "Starting web and mysql servers...\n"
service apache2 start
service mysql start

echo -e "$(tput setaf 1)Creating first time 'framework' database (empty)\n $(tput sgr0)"

mysqladmin -u root create framework -ptoor

echo -e "$(tput setaf 1)\n\nInstall of Smartphone Pentest Framework is complete!\n $(tput sgr0)"
echo -e "$(tput setaf 1)You need to edit your config file to your liking in the following location:${PWD}/frameworkconsole/config\n $(tput sgr0)"

echo -e "$(tput setaf 1)Once config is setup you can run ./framework.py in the frameworkconsole directory,\n"
echo -e "$(tput setaf 1)This concludes the install...enjoy! $(tput sgr0)"
